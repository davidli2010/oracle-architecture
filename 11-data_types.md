# 数据类型

## 概述

Oracle提供了22种不同的SQL数据类型供使用，简要介绍如下：
- CHAR：这是一个定长字符串，会用空格填充来达到其最大长度。非null的CHAR(10)包含10**字节**信息。CHAR字段最多可以存储2000字节的信息。
- NCHAR：这是一个包含UNICODE格式数据的定长字符串。非null得NCHAR(10)总是包含10个**字符**的信息。NCHAR字段最多可以存储2000字节的信息。
- VARCHAR2：这是VARCHAR的同义词。这是一个变长字符串，与CHAR类型不同，它不会用空格将字段或变量填充至最大长度。VARCHAR2(10)可能包含0~10字节的信息，它最多可以存储4000字节的信息。自Oracle12c起，它可以存储多至32767字节的信息。
- NVARCHAR2：这是一个包含UNICODE格式数据的变长字符串。NVARCHAR2(10)可以包含0~10个**字符**的信息，NVARCHAR2最多可以存储4000字节的信息。自Oracle12c起，它可以存储多至32767字节的信息。
- RAW：这是一种变长二进制数据类型，也就是说采用这种数据类型存储的数据不会发生字符集转换。这种类型最多可以存储2000字节的信息。自Oracle12c起，它可以存储多至32767字节的信息。
- NUMBER：这种数据类型能存储精度最多达38位的数字，范围为1.0\*10^(-130)至1.0\*10(126)（不含）。这种类型的数字会以变长方式来存储，其长度在0~22字节（NULL值长度为0）.
- BINARY_FLOAT：32位单精度浮点数，可以支持至少6位精度，占用磁盘上5字节的存储空间。
- BINARY_DOUBLE：64位双精度浮点数，可以支持至少15位精度，占用磁盘上9字节的存储空间。
- LONG：存储最多2GB的字符数据。提供LONG类型只是为了保证向后兼容性，所以强烈建议新应用中不要使用LONG类型，使用CLOB类型。
- LONG RAW：LONG RAW类型能存储多达2GB的二进制信息。处于与LONG同样的原因，建议所有新开发的应用都使用BLOB类型。
- DATE：这是一个7字节的定宽日期/时间数据类型，其中共包含7个属性：世纪、世纪中的哪一年、月份、月中的哪一天、小时、分钟和秒。
- TIMESTAMP：这是一个7字节或11字节的定宽日期/时间数据类型（高精度会使用11字节）。TIMESTAMP可以包含小数秒（fractional second）；带小数秒的TIMESTAMP最多可以保留9位小数。
- TIMESTAMP WITH TIME ZONE：与前一种类型类似，这是一个13字节的定宽TIMESTAMP，不过它还提供了时区支持。因为时区信息是与TIMESTAMP储存在一起的，所以数据在插入时的时区信息会与时间一起保留下来。
- TIMESTAMP WITH LOCAL TIME ZONE：与TIMESTAMP类似，这是一种7字节或11字节的定宽日期/时间数据类型（高精度会使用11字节）；不过，这种类型对时区敏感（time zone sensitive）。如果插入或修改这类数据，那么数据库会参考数据中提供的TIME ZONE以及数据库本身所在的时区，对数据中的日期/时间部分进行“规范化”，将其转换为数据库所在时区的时间。
- INTERVAL YEAR TO MONTH：这是一个5字节的定宽数据类型，用于存储一个时段。这个类型将时段存储为年数和月数。
- INTERVAL DAY TO SECOND：这是一个11字节的定宽数据类型，用于存储一个时段。这个类型将时段存储为天/小时/分钟/秒数，还可以有最多9位的小数秒。
- BLOB：在Oracle10g及以上的版本中能够存储最多(4GB - 1)*(数据库块大小)字节的数据。BLOB包含不需要进行字符集转换的“二进制”数据。
- CLOB：在Oracle10g及以上的版本中能够存储最多(4GB - 1)*(数据库块大小)字节的数据。当发生字符集转换时，CLOB会受到影响。这种数据类型很适合存储大块纯文本信息。
- NCLOB：在Oracle10g及以上的版本中能够存储最多(4GB - 1)*(数据库块大小)字节的数据。NLOB会存储以数据库国家字符集编码的信息，而且像CLOB一样，当发生字符集转换时，这种类型也会受到影响。
- BFILE：这种数据类型可以在数据库列中存储一个Oracle目录对象和一个文件名，我们可以通过它来读取这个文件。这实际上允许你以只读的方式访问数据库服务器上的操作系统文件，就好像它们存储在数据库表中一样。
- ROWID：ROWID实际上是数据库表中行的地址，它有10字节长。ROWID中编码的信息，不但足以在磁盘上定位每一行，而且还能识别出ROWID指向的那行数据所属的对象。
- UROWID：UROWID是一个通用ROWID，用于没有固定ROWID的表（如IOT和通过异构数据库网关访问的表）。UROWID通常表现为主键的值，因此UROWID的大小会根据所指向的对象而有所变化。

如INT、INTEGER、SMALLINT、FLOAT、REAL等类型实际上都是在上面所列的某种基本类型的基础上实现的，也就是说，它们是Oracle固有类型的同义词。

## 字符和二进制串类型

Oracle中的字符数据类型包括CHAR、VARCHAR2及其带N的相应变体（NCHAR和NVARCHAR2）。CHAR和NCHAR类型能存储2000字节的文本，VARCHAR2和NVARCHAR2可容纳4000字节。

CHAR、VARCHAR2、NCHAR和NVARCHAR2中的数据会根据需要，由数据库在不同字符集之间转换。

### NLS概述

NLS全称是国家语言支持（National Language Support）。NLS控制着数据的许多方面，例如数据如何存储；还有数据会显示成多个逗号和一个点号（如1,000,000.01），还是多个点号和一个逗号（如1.000.000,01）。最重要的是，它控制着以下两个方面：
- 文本数据持久存储在磁盘上时如何编码；
- 透明地将数据从一个字符集转换到另一个字符集。

### 字符串

Oracle中有4种基本的字符串类型，分别是CHAR、VARCHAR2、NCHAR和NVARCHAR2。在Oracle中，所有字符串都以相同的格式存储。在数据库块上，每个字符串最前面都有一个1~3字节的长度部分，其后才是数据，如果数据为NULL，长度部分则为一个单字节值0xFF。

如果串的长度小于或等于250（0x01~0xFA），Oracle会使用1字节来表示长度。对于所有长度超过250的串，都会在一个标志字节0xFE后跟2字节来表示长度。

VARCHAR2和CHAR类型可以用两种方式来制定长度：
- 用字节指定：VARCHAR2(10 byte)。这个字段最多能存储10字节的数据。
- 用字符指定：VARCHAR2(10 char)。这个字段最多能存储10字符的数据，其占用的空间有可能会达到40字节。

## 二进制串：RAW类型

Oracle除了支持文本，还支持二进制数据的存储。CHAR和VARCHAR2类型需要进行字符集转换，而二进制数据不会做这种字符集转换。因此，二进制数据类型不适合存储用户的文本数据，而是比较适合存储加密信息、字处理文档等。

Oracle支持下面3种数据类型来存储二进制数据：
- RAW类型：能够存储多达2000字节的RAW数据。自12c起，这种类型能够存储至多32767字节的信息。
- BLOB类型：支持更大的二进制数据。
- LONG RAW类型：这是为支持向后兼容性而提供的，新应用不应考虑使用这个类型。

## 数值类型

- NUMBER：Oracle NUMBER类型能以极大的精度存储数值，其精度可达38位。它的底层数据格式类似于一种紧缩十进制（Packed Decimal）。Oracle NUMBER类型是一种变长格式，长度为0~22字节。它可以存储小到10^-130、大到（但不包括）10^126的任何数值，这是目前最为常用的数值类型。
- BINARY_FLOAT：这是一种符合IEEE标准的单精度浮点数。它在磁盘上会占用5字节的存储空间：其中4个固定字节用于存储浮点数，还有一个长度字节。BINARY_FLOAT能存储有6位精度、范围在~±10^38.53的数值。
- BINARY_DOUBLE：这是一种符合IEEE的双精度浮点数。它在磁盘上会占用9字节的存储空间：其中8个固定字节用于存储浮点数，还有一个长度字节。BINARY_DOUBLE能存储有13位精度、范围在~±10^308.25的数值。

### 非固有数值类型

除了NUMBER、BINARY_FLOAT和BINARY_DOUBLE类型，Oracle在语法上还支持以下数值数据类型：
- NUMBERIC(p, s)：完全映射至NUMBER(p, s)。如果p未指定，则默认为38。
- DECIMAL(p, s)或DEC(p, s)：完全映射至NUMBER(p, s)。如果p未指定，则默认为38。
- INTEGER或INT：完全映射至NUMBER(38)类型。
- SMALLINT：完全映射至NUMBER(38)类型。
- FLOAT(p)：映射至NUMBER类型。
- DOUBLE PREFISION：映射至NUMBER类型。
- REAL：映射至NUMBER类型。

## LONG类型

Oracle中的LONG类型有下面两种：
- LONG文本类型，能存储2GB的文本。与VARCHAR2或CHAR类型一样，存储在LONG类型中的文本会进行字符集转换。
- LONG RAW类型，能存储2GB的原始二进制数据。

>不要创建带LONG列的表，而应该使用LOB列（CLOB、NCLOB、BLOB），支持LONG列只是为了保证向后兼容性。

## DATE、TIMESTAMP和INTERVAL类型

Oracle固有数据类型DATE、TIMESTAMP和INTERVAL是紧密相关的。DATE和TIMESTAMP类型存储精度可变的日期/时间，INTERVAL类型可以很容易地存储一个时间量，如“8个小时”或“30天”。如果我们将两个时间戳相减，就会得到一个时间间隔（INTERVAL）。

## LOB类型

Oracle中支持4种类型的LOB：
- CLOB：字符LOB。这种类型用于存储大量的文本信息，如XML或者纯文本。这个数据类型会受到字符集转换的影响。
- NCLOB：另一种类型的字符LOB。存储在这一列中的数据所采用的字符集是根据数据库的国家字符集，而不是数据库的默认字符集。
- BLOB：二进制LOB。这种类型用于存储大量的二进制信息，如文字处理文档、图像等。数据库不对这种类型的字段进行字符集转换，应用向BLOB中写入的每一位数据，再取出时都会按照原样（每一位都一样）返回。
- BFILE：二进制文件LOB。与其说它是一个数据库存储实体，不如说是一个指针。数据库在BFILE中仅存储一个指向操作系统文件的指针，这个文件在数据库之外维护，其实并不是数据库的一部分。BFILE对这个文件中的内容进行只读访问。

### 内部LOB

如果表中有LOB列，那么这个表就会有多个段。表中的LOB实际上只是指向LOBINDEX的一个指针，LOBINDEX会再指向LOB数据的各个片段。

默认情况下，Oracle不会缓存LOB，此时每次访问LOB，不论是读还是写，都会进行物理I/O操作。

## ROWID/UROWID类型

每个表中的每一行都有一个与之对应的ROWID或UROWID。当我们用SQL从表中获取它们时，通常把它们看作伪列（pseudo column），也就是说它们并不真正地存储在行中，而是行的一个派生属性。ROWID基于行的物理位置而定，它并不随行存储。UROWID则基于行的主键，从某种意义上讲，好像它是随行存储的；但是事实上并非如此，因为UROWID并不作为一个单独的列存在，它只是一些列的某个函数值。

有些操作可能会导致行的ROWID改变，例如：
- 在分区表中，更新一行的分区键列，使这一行必须从一个分区移至另一个分区；
- 使用FLASHBACK TABLE命令将一个数据库表恢复到以前的某个时间点；
- MOVE操作或者多分区操作，如分解（SPLIT）或者合并（MERGE）分区；
- 使用ALTER TABLE SHRINK SPACE命令来收缩段。
