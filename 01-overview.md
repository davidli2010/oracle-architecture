# 概述

## 数据库

操作系统文件或磁盘的集合。Oracle 12c提供了3种不同类型的数据库。
- 单租户数据库(database)：完整包含了全套的数据文件、控制文件、重做日志文件、参数文件等。包含了所有的元数据、数据、代码以及所有应用的元数据、数据和代码。12c之前的所有Oracle数据库都是这种类型。
- 容器数据库或根数据库(container/root database)：包含了一整套数据文件、控制文件、重做日志文件及参数文件，但它仅用于存放Oracle的元数据、数据库自用数据以及Oracle内部代码。不存放应用程序的数据及代码而仅仅存放上面提到的Oracle自用的实体。这种数据库是完全自包含的，不依赖其他对象就可以被实例装载和打开。
- 可插拔数据库(pluggable database)：仅包含数据文件，不是完全自包含的：必须将其插在某个容器数据库（或根数据库）上才可以对其打开进行读写。这个数据库仅包含应用的元数据及应用的对象、数据及代码。仅包含数据文件，没有重做日志、控制文件、参数文件等，但它在使用过程中会利用其所插在的CDB上的这些类型的文件。

## 实例

一组Oracle后台进程/线程以及一个共享内存区域，这些内存由同一台计算机上运行的线程/进程所共享。Oracle在这里存放及维护易失的、非持久性的内容（有些可以刷到磁盘）。需要注意的是，就算没有磁盘存储，数据库实例也能存在。

实例和数据库之间的关系是：
- 单租户或容器数据库可以由多个实例装载和打开，而实例在任何时间点只能装载和打开一个数据库。实例在其整个生命周期最多能装载和打开一个数据库。
- 对于可插拔数据库(PDB)来说，它在任何时间点只能与一个容器数据库(CDB)关联，进而只能与一个实例关联。实例打开并装载了CDB之后，其包含的PDB也会使用这个实例。一个实例每次可以同时访问多个（最多约250）个PDB，即每个实例可以为多个PDB同时提供服务，但是它只能打开一个CDB或单租户数据库。

## SGA和后台进程

Oracle有一个很大的内存块，称为系统全局区(SGA)，用于（但不限于）：
- 维护所有进程需要访问的内部数据结构；
- 缓存磁盘上的数据，另外重做数据写至磁盘之前先在这里缓存；
- 保存已解析的SQL计划，等等。

Oracle有一组“附加到（attach）”SGA的进程，附加机制因操作系统而异。在UNIX/Linux环境，这些进程会附到一个很大的共享内存段。在Windows中，这些进程使用C调用（malloc()）来分配内存。

## 连接Oracle

### 专用服务器

登录时，Oracle创建一个新的进程，这通常称为**专用服务器**配置。对于每个会话，都会出现一个新的专用服务器进程，会话与专用服务器之间存在一对一的映射。

按照定义，这个专用服务器不是实例的一部分。客户进程会通过某种网络通道与这个专用服务器直接通信，并由这个服务器进程接收和执行SQL。

### 共享服务器

Oracle还可以接受另一种方式的连接，称为**共享服务器**。如果采用这种方式，数据库就不会对每个用户连接创建新的线程或UNIX/Linux进程。

在共享服务器中，Oracle使用一个“共享进程”池为多个用户提供服务。共享服务器实际上就是一种连接池机制，这些进程将由所有会话共享。为了共享这些进程，Oracle使用了一个或一组称为**调度程序**（dispatcher）的进程。客户进程通过网络与一个调度程序进程通信，这个调度程序进程将客户的请求放入SGA中的请求队列；第一个空闲的共享服务器会得到这个请求，并进行处理；完成这个命令后，共享服务器会把响应放在原调度程序的响应队列中。调度程序进程一直在监视这个队列，当他发现有结果后，就会把结果传给客户。

### 可插拔式数据库

可插拔式数据库(PDB)在多租户架构下是一组非自包含的数据文件的集合，它仅包含应用的数据与元数据。Oracle自用的数据并不存放在这些数据文件中，而放在容器数据库中。如果要使用或查询PDB，就必须将其“插”到一个容器数据库(CDB)中。CDB中只有Oracle自用的数据及元数据，这些是Oracle运行时所需的必要信息。PDB会存放“剩下的”数据及元数据。

Oracle设计PDB及多租户架构主要有两个目的：
- 在单个主机上，有效地降低多个数据库/应用对资源的使用量；
- 在单个主机上，降低DBA对多个数据库/应用进行维护的工作量。