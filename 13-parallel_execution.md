# 并行执行

并行执行（parallel execution）是Oracle企业版才有的特性（标准版没有）。

所谓并行执行，是指能够将一个大型串行任务（包括所有的DML和一般的DDL）物理地划分为多个较小的部分，这些较小的部分可以同时得到处理。
- 并行查询：这是指能使用多个操作系统进程或线程来执行一个查询。Oracle会发现能并行执行的操作（如全表扫描或大规模排序），并创建一个查询计划来并行实现。
- 并行DML（PDML）：这在本质上与并行查询很相似，但是PDML主要是使用并行处理来执行修改（INSERT、UPDATE、DELETE和MERGE）。
- 并行DDL：并行DDL是指Oracle能并行地执行大规模的DDL操作。例如，索引重建、创建一个新索引、通过CREATE TABLE AS SELECT进行的数据加载以及大表的重组等都可以使用并行处理。
- 并行加载：外部表和SQL\*Loader可以并行加载数据。
- 过程并行化：这是指能并行地运行所开发的代码。

还有两种可以用并行来实现的操作：
- 并行恢复（parallel recovery）：Oracle可以让数据库恢复操作并行化执行。
- 并行复制（parallel propagation）：并行执行还有一个比较典型的数据复制场景，Oracle高级复制选件能够异步并行地进行复制，并行模式下可以显著提高数据复制操作的吞吐量。

## 何时使用并行执行

>并行查询（PARALLEL QUERY）选项本质上是不可扩展的。

并行执行本质上是一个不可扩展的解决方案，设计为允许单个用户或某个特定SQL语句占用数据库的所有资源。如果某个特性允许一个人使用所有可用的资源，倘若再运行两个人使用这个特性，就会遇到明显的争用问题。随着系统上并发用户数的增加，要应付这些并发用户，系统上的资源（内存、CPU和I/O）开始表现出有些勉为其难，此时能不能执行并行操作就成问题了。

所以，在应用并行执行之前，需要保证以下两个前提成立：
- 必须有一个非常大的任务，如对50GB数据进行全表扫描。
- 必须有足够的可用资源。在对50GB数据进行并行全表扫描之前，需要确保有足够的空闲CPU处理并行进程，还要有足够的I/O能力。

## 并行查询

并行查询允许将一个SQL SELECT语句划分为多个较小的查询，每个部分的查询并发地运行，然后将各个部分的结果组合起来，提供最终的答案。

## 并行DML

在PDML期间，Oracle可以使用多个并行执行服务器来执行INSERT、UDPATE、DELETE或MERGE，而不是只利用一个串行进程。在一个有充足I/O带宽的多CPU主机上，对于大规模的DML操作，可能会得到很大的速度提升。

## 并行DDL

以下SQL DDL命令允许“并行化”。
- CREATE INDEX：多个并行执行服务器可以扫描表，对数据排序，并把排序后的段写到索引结构中。
- CREATE TABLE AS SELECT：执行SELECT的查询可以使用并行查询来执行，而且表加载本身也可以并行完成。
- ALTER INDEX REBUILD：索引结构可以并行重建。
- ALTER TABLE MOVE：表可以并行移动。
- ALTER TABLE SPLIT|COALESCE PARTITION：表分区可以并行地分解或合并。
- ALTER INDEX SPLIT PARTITION：索引分区可以并行地分解。
- CREATE/ALTER METERIALIZED VIEW：用并行执行来创建物化视图或者修改默认的并行度。
